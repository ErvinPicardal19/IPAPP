pipeline {
    agent { 
        node {
            label 'IPAPP-DOCKER-AGENT-PYTHON'
            }
      }
    triggers {
        pollSCM '* * * * *'
    }
    stages {
        stage('Build') {
            parallel {
               stage('Build') {
                  steps {
                     sh 'echo "building the repo"'
                     sh '''
                     pip install -r requirements.txt
                     '''
                  }
               }
            }
        }
        stage('Test') {
            parallel{
               stage('Running server.py') {
                  steps {
                     sh '''
                     python3 server.py
                     '''
                  }
               }
               stage('Running test.py') {
                  steps {
                     sh '''
                     ps
                     python3 test.py
                     input(id: "Deploy Gate", message: "Deploy ${params.project_name}?", ok: 'Deploy')
                     '''
                  }
               }
            }
        }
        stage('Deliver') {
            steps {
                echo 'Deliver....'
                sh '''
                echo "doing delivery stuff.."
                '''
            }
        }
    }
}